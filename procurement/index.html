<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <script>document.documentElement.style.visibility='hidden'</script><script src="/auth-guard.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Central Kitchen Procurement</title>
  <link rel="stylesheet" href="/css/app.css"/>
</head>
<body data-module="procurement">

<main>
  <div class="card" style="max-width:700px;margin:0 auto 20px;">
    <h2>ðŸ“Š Quick Stats</h2>
    <div class="stats-bar" id="statsBar">
      <div class="stat-box"><div class="num" id="statTotal">â€”</div><div class="lbl">Total</div></div>
      <div class="stat-box"><div class="num" id="statPending">â€”</div><div class="lbl">Pending</div></div>
      <div class="stat-box"><div class="num" id="statDone">â€”</div><div class="lbl">Done</div></div>
    </div>
  </div>

  <div class="card" style="max-width:700px;margin:0 auto 20px;">
    <div class="qr-container">
      <h2>ðŸ“± Scan to Submit a Request</h2>
      <p>Staff can scan this QR code with any phone or tablet to submit a procurement request.</p>
      <img class="qr-code" src="/api/qr" alt="QR Code"/>
      <p class="qr-url" id="formUrl"></p>
      <div style="display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin-top:8px;">
        <a href="/procurement/request" class="btn btn-primary">ðŸ“‹ Open Request Form</a>
        <a href="/procurement/requests" class="btn btn-outline">ðŸ“Š View All Requests</a>
        <a href="/api/qr" download="procurement-qr.png" class="btn btn-outline">â¬‡ Download QR</a>
      </div>
    </div>
  </div>
</main>

<script>
  document.getElementById('formUrl').textContent = `${window.location.origin}/procurement/request`;

  async function loadStats() {
    try {
      const all = await fetch('/api/requests').then(r => r.json());
      document.getElementById('statTotal').textContent   = all.length;
      document.getElementById('statPending').textContent = all.filter(r => r.status === 'Pending').length;
      document.getElementById('statDone').textContent    = all.filter(r => r.status === 'Done').length;
    } catch(_) {}
  }
  loadStats();
</script>
  <script src="/js/shell.js"></script>
</body>
</html>
