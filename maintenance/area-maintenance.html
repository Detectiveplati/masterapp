<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Report Area Issue | Central Kitchen</title>
    <style>
        :root {
            --accent:   #c0392b;
            --accent-2: #d35400;
            --ink:      #121316;
            --muted:    #5b5b5b;
            --card:     #ffffff;
            --border:   rgba(18,19,22,0.10);
            --shadow:   rgba(0,0,0,0.08);
            --success:  #27ae60;
            --bg:       #f6f4ef;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg);
            color: var(--ink);
            min-height: 100vh;
        }

        /* â”€â”€ Lang toggle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .lang-bar {
            position: fixed;
            top: 12px;
            right: 12px;
            z-index: 100;
            display: flex;
            background: rgba(255,255,255,0.92);
            border: 1px solid var(--border);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.12);
            backdrop-filter: blur(6px);
        }

        .lang-btn {
            padding: 6px 14px;
            font-size: 0.8rem;
            font-weight: 700;
            border: none;
            background: transparent;
            cursor: pointer;
            color: var(--muted);
            transition: all 0.15s;
        }

        .lang-btn.active {
            background: var(--accent);
            color: white;
            border-radius: 20px;
        }

        /* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        header {
            background: linear-gradient(135deg, #1a252f, #2c3e50);
            color: white;
            padding: 20px 20px 16px;
            text-align: center;
        }

        .logo {
            width: 56px;
            height: 56px;
            border-radius: 12px;
            margin: 0 auto 10px;
            display: block;
            box-shadow: 0 4px 14px rgba(0,0,0,0.3);
        }

        header h1 { font-size: 1.25rem; font-weight: 800; }
        header p  { font-size: 0.83rem; opacity: 0.72; margin-top: 4px; }

        /* â”€â”€ Main â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        main {
            max-width: 560px;
            margin: 0 auto;
            padding: 24px 16px 60px;
        }

        /* Pre-selected area banner */
        .area-banner {
            display: none;
            background: linear-gradient(90deg, #fff7ed, #fef3e2);
            border: 1px solid #fed7aa;
            border-left: 4px solid var(--accent-2);
            border-radius: 10px;
            padding: 11px 14px;
            margin-bottom: 18px;
            font-size: 0.88rem;
            font-weight: 700;
            color: var(--ink);
            align-items: center;
            gap: 8px;
        }

        .area-banner.visible { display: flex; }

        /* â”€â”€ Form card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .form-card {
            background: var(--card);
            border-radius: 16px;
            border: 1px solid var(--border);
            box-shadow: 0 8px 24px var(--shadow);
            padding: 24px 20px 28px;
        }

        .section-label {
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: var(--muted);
            margin-bottom: 12px;
            margin-top: 22px;
            padding-bottom: 6px;
            border-bottom: 1px solid var(--border);
        }

        .section-label:first-child { margin-top: 0; }

        .field { margin-bottom: 16px; }

        label {
            display: block;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--ink);
            margin-bottom: 6px;
        }

        label .req { color: var(--accent); margin-left: 2px; }

        input[type="text"],
        input[type="tel"],
        select,
        textarea {
            width: 100%;
            padding: 12px 14px;
            border: 1.5px solid var(--border);
            border-radius: 10px;
            font-size: 0.95rem;
            font-family: inherit;
            color: var(--ink);
            background: #fafafa;
            -webkit-appearance: none;
            appearance: none;
            transition: border-color 0.15s, box-shadow 0.15s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--accent);
            background: #fff;
            box-shadow: 0 0 0 3px rgba(192,57,43,0.10);
        }

        textarea { resize: vertical; min-height: 110px; line-height: 1.5; }

        /* Submit */
        .btn-submit {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--accent), #e74c3c);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            margin-top: 24px;
            transition: transform 0.15s, box-shadow 0.15s;
            box-shadow: 0 4px 14px rgba(192,57,43,0.25);
            letter-spacing: 0.3px;
        }

        .btn-submit:hover   { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(192,57,43,0.3); }
        .btn-submit:active  { transform: none; }
        .btn-submit:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }

        /* Validation */
        .field-error { font-size: 0.78rem; color: var(--accent); margin-top: 4px; display: none; }
        .field.has-error input,
        .field.has-error select,
        .field.has-error textarea { border-color: var(--accent); }
        .field.has-error .field-error { display: block; }

        /* â”€â”€ Success â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        #successScreen {
            display: none;
            text-align: center;
            padding: 40px 20px;
        }

        .success-icon  { font-size: 4rem; margin-bottom: 16px; }
        .success-title { font-size: 1.4rem; font-weight: 800; color: var(--success); margin-bottom: 8px; }
        .success-sub   { font-size: 0.92rem; color: var(--muted); margin-bottom: 6px; }

        .issue-ref {
            display: inline-block;
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            color: #15803d;
            border-radius: 8px;
            padding: 4px 14px;
            font-weight: 700;
            font-size: 0.9rem;
            margin: 10px 0 24px;
        }

        .btn-again {
            display: inline-block;
            padding: 14px 28px;
            background: linear-gradient(135deg, var(--accent-2), #e67e22);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
        }

        /* â”€â”€ Priority toggle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .priority-toggle {
            display: flex;
            gap: 10px;
            margin-top: 4px;
        }
        .priority-toggle input[type="radio"] { display: none; }
        .priority-toggle label.ptoggle {
            flex: 1;
            padding: 11px 10px;
            border-radius: 10px;
            border: 2px solid var(--border);
            text-align: center;
            font-size: 0.9rem;
            font-weight: 700;
            cursor: pointer;
            background: #fafafa;
            color: var(--muted);
            transition: all 0.15s;
            display: block;
            margin-bottom: 0;
        }
        .priority-toggle input[value="Normal"]:checked + label.ptoggle {
            border-color: var(--success);
            background: #f0fdf4;
            color: var(--success);
            box-shadow: 0 0 0 3px rgba(39,174,96,0.12);
        }
        .priority-toggle input[value="Urgent"]:checked + label.ptoggle {
            border-color: var(--accent);
            background: #fff5f5;
            color: var(--accent);
            box-shadow: 0 0 0 3px rgba(192,57,43,0.12);
        }
        .photo-upload-label {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 14px 16px;
            border: 1.5px dashed var(--border);
            border-radius: 10px;
            background: #fafaf8;
            cursor: pointer;
            font-size: 0.9rem;
            color: var(--muted);
            font-weight: 500;
            transition: border-color 0.15s, background 0.15s;
        }
        .photo-upload-label:hover {
            border-color: var(--accent);
            background: #fff8f6;
            color: var(--accent);
        }
        .photo-upload-label input { display: none; }
        .photo-preview {
            margin-top: 10px;
            display: none;
        }
        .photo-preview img {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            border: 1px solid var(--border);
            object-fit: cover;
        }
        .photo-name {
            font-size: 0.8rem;
            color: var(--muted);
            margin-top: 5px;
        }

    </style>
</head>
<body>

<!-- Language toggle -->
<div class="lang-bar">
    <button class="lang-btn active" id="btnEN" onclick="setLang('en')">EN</button>
    <button class="lang-btn"        id="btnZH" onclick="setLang('zh')">ä¸­æ–‡</button>
</div>

<header>
    <img src="assets/Chilli-Api-Logo-170px.png" alt="Logo" class="logo">
    <h1 id="hdrTitle">ğŸ—ï¸ Report Area Issue</h1>
    <p id="hdrSub">Central Kitchen â€” Facility Issue Reporting</p>
</header>

<main>
    <div class="area-banner" id="areaBanner">
        <span>ğŸ“</span>
        <span id="areaBannerText"></span>
    </div>

    <!-- FORM -->
    <div class="form-card" id="formCard">
        <form id="issueForm" novalidate>

            <div class="section-label" id="lblSecLocation">ğŸ“ LOCATION</div>

            <div class="field" id="fieldUnit">
                <label for="unit" id="lblUnit">Unit <span class="req">*</span></label>
                <select id="unit" name="unit" onchange="onUnitChange()">
                    <option value="" id="optUnitDefault">â€” Select unit â€”</option>
                    <option value="#06-27/15/16/17 (Main CK Area)" selected>#06-27/15/16/17 (Main CK Area)</option>
                    <option value="#06-24 (Raw Prep)">#06-24 (Raw Prep)</option>
                    <option value="#06-19 (Bakery)">#06-19 (Bakery)</option>
                    <option value="#06-08 (Dishwashing)">#06-08 (Dishwashing)</option>
                    <option value="#05-26">#05-26</option>
                    <option value="#05-27 (Tay Sauce Kitchen)">#05-27 (Tay Sauce Kitchen)</option>
                    <option value="#04-08 (Confinement)">#04-08 (Confinement)</option>
                </select>
                <div class="field-error" id="errUnit">Please select a unit.</div>
            </div>

            <div class="field" id="fieldSubArea" style="display:none;">
                <label for="subArea" id="lblSubArea">Area <span class="req">*</span></label>
                <select id="subArea" name="subArea">
                    <option value="" id="optSubAreaDefault">â€” Select area â€”</option>
                    <option value="Combi Oven Area">Combi Oven Area</option>
                    <option value="Deep Frying Area">Deep Frying Area</option>
                    <option value="Stir Frying Area">Stir Frying Area</option>
                    <option value="Packing Area">Packing Area</option>
                    <option value="Salad Room">Salad Room</option>
                    <option value="Fruit Room">Fruit Room</option>
                    <option value="Cold Room">Cold Room</option>
                    <option value="Pan Fry Area">Pan Fry Area</option>
                    <option value="Braising Area">Braising Area</option>
                    <option value="Big Store">Big Store</option>
                    <option value="Small Store">Small Store</option>
                    <option value="Old Sauce Area">Old Sauce Area</option>
                    <option value="Office/Changing Room Area">Office/Changing Room Area</option>
                    <option value="Vegetable Prep Room">Vegetable Prep Room</option>
                </select>
                <div class="field-error" id="errSubArea">Please select an area.</div>
            </div>

            <div class="field">
                <label for="specificLocation" id="lblSpecific">Specific Location <span style="font-weight:400;color:var(--muted)" id="lblOptional">(optional)</span></label>
                <input type="text" id="specificLocation" name="specificLocation" placeholder="e.g. Near sink #2, left corner" id="phSpecific">
            </div>

            <div class="section-label" id="lblSecDetails">ğŸ“‹ ISSUE DETAILS</div>

            <div class="field" id="fieldIssue">
                <label for="issue" id="lblIssue">Issue <span class="req">*</span></label>
                <textarea id="issue" name="issue" placeholder="Describe the issue â€” what happened, where exactly..."></textarea>
                <div class="field-error" id="errIssue">Please describe the issue.</div>
            </div>

            <div class="field">
                <label id="lblPriority">Priority</label>
                <div class="priority-toggle">
                    <input type="radio" name="priority" id="prioNormal" value="Normal" checked>
                    <label class="ptoggle" for="prioNormal" id="lblPrioNormal">âœ… Normal</label>
                    <input type="radio" name="priority" id="prioUrgent" value="Urgent">
                    <label class="ptoggle" for="prioUrgent" id="lblPrioUrgent">ğŸš¨ Urgent</label>
                </div>
            </div>

            <div class="section-label" id="lblSecReporter">ğŸ‘¤ REPORTER</div>

            <div class="field" id="fieldReportedBy">
                <label for="reportedBy" id="lblReportedBy">Your Name <span class="req">*</span></label>
                <input type="text" id="reportedBy" name="reportedBy" placeholder="Enter your name">
                <div class="field-error" id="errReportedBy">Please enter your name.</div>
            </div>

            <div class="section-label">ğŸ“· PHOTO <span style="font-weight:400;text-transform:none;letter-spacing:0;font-size:0.78rem;color:var(--muted)">(optional)</span></div>

            <div class="field">
                <label class="photo-upload-label" for="issuePhoto">
                    <span>ğŸ“¸</span>
                    <span id="photoLabelText">Tap to attach a photo</span>
                    <input type="file" id="issuePhoto" name="image" accept="image/*" onchange="handlePhotoSelect(this)">
                </label>
                <div class="photo-preview" id="photoPreview">
                    <img id="photoPreviewImg" src="" alt="Preview">
                    <div class="photo-name" id="photoFileName"></div>
                </div>
            </div>

            <button type="submit" class="btn-submit" id="submitBtn">ğŸ“¤ Submit Issue Report</button>
        </form>
    </div>

    <!-- SUCCESS -->
    <div id="successScreen">
        <div class="success-icon">âœ…</div>
        <div class="success-title" id="successTitle">Issue Reported!</div>
        <div class="success-sub" id="successSub1">Thank you. Your report has been logged.</div>
        <div class="issue-ref" id="issueRef">â€”</div>
        <div class="success-sub" id="successSub2" style="margin-bottom:24px;">The maintenance team will review and respond.</div>
        <button class="btn-again" id="btnAgain" onclick="resetForm()">Report Another Issue</button>
    </div>
</main>

<script src="js/api.js"></script>
<script>
// â”€â”€ Constants â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const MAIN_CK   = '#06-27/15/16/17 (Main CK Area)';
const SUB_AREAS = ['Combi Oven Area','Deep Frying Area','Stir Frying Area','Packing Area','Salad Room','Fruit Room','Cold Room','Pan Fry Area','Braising Area','Big Store','Small Store','Old Sauce Area','Office/Changing Room Area','Vegetable Prep Room'];

// â”€â”€ Translations â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const T = {
    en: {
        hdrTitle:        'ğŸ—ï¸ Report Area Issue',
        hdrSub:          'Central Kitchen â€” Facility Issue Reporting',
        lblSecLocation:  'ğŸ“ LOCATION',
        lblUnit:         'Unit',
        optUnitDefault:  'â€” Select unit â€”',
        lblSubArea:      'Area',
        optSubAreaDefault: 'â€” Select area â€”',
        lblSpecific:     'Specific Location',
        lblOptional:     '(optional)',
        lblSecDetails:   'ğŸ“‹ ISSUE DETAILS',
        lblIssue:        'Issue',
        phIssue:         'Describe the issue â€” what happened, where exactlyâ€¦',
        lblSecReporter:  'ğŸ‘¤ REPORTER',
        lblReportedBy:   'Your Name',
        phReportedBy:    'Enter your name',
        submitBtn:       'ğŸ“¤ Submit Issue Report',
        lblPriority:     'Priority',
        lblPrioNormal:   'âœ… Normal',
        lblPrioUrgent:   'ğŸš¨ Urgent',
        errUnit:         'Please select a unit.',
        errSubArea:      'Please select an area.',
        errIssue:        'Please describe the issue.',
        errReportedBy:   'Please enter your name.',
        successTitle:    'Issue Reported!',
        successSub1:     'Thank you. Your report has been logged.',
        successSub2:     'The maintenance team will review and respond.',
        btnAgain:        'Report Another Issue',
        bannerPrefix:    'Location:',
        submitting:      'Submittingâ€¦',
        submitFailed:    'Failed to submit: '
    },
    zh: {
        hdrTitle:        'ğŸ—ï¸ åŒºåŸŸé—®é¢˜æŠ¥å‘Š',
        hdrSub:          'ä¸­å¤®å¨æˆ¿ â€” è®¾æ–½é—®é¢˜æŠ¥å‘Š',
        lblSecLocation:  'ğŸ“ ä½ç½®',
        lblUnit:         'å•ä½',
        optUnitDefault:  'â€” è¯·é€‰æ‹©å•ä½ â€”',
        lblSubArea:      'åŒºåŸŸ',
        optSubAreaDefault: 'â€” è¯·é€‰æ‹©åŒºåŸŸ â€”',
        lblSpecific:     'å…·ä½“ä½ç½®',
        lblOptional:     'ï¼ˆå¯é€‰ï¼‰',
        lblSecDetails:   'ğŸ“‹ é—®é¢˜è¯¦æƒ…',
        lblIssue:        'é—®é¢˜æè¿°',
        phIssue:         'è¯·æè¿°é—®é¢˜ â€” å‘ç”Ÿäº†ä»€ä¹ˆã€å…·ä½“ä½ç½®â€¦',
        lblSecReporter:  'ğŸ‘¤ æŠ¥å‘Šäºº',
        lblReportedBy:   'æ‚¨çš„å§“å',
        phReportedBy:    'è¯·è¾“å…¥æ‚¨çš„å§“å',
        submitBtn:       'ğŸ“¤ æäº¤é—®é¢˜æŠ¥å‘Š',
        lblPriority:     'ä¼˜å…ˆçº§',
        lblPrioNormal:   'âœ… ä¸€èˆ¬',
        lblPrioUrgent:   'ğŸš¨ ç´§æ€¥',
        errUnit:         'è¯·é€‰æ‹©å•ä½ã€‚',
        errSubArea:      'è¯·é€‰æ‹©åŒºåŸŸã€‚',
        errIssue:        'è¯·æè¿°é—®é¢˜ã€‚',
        errReportedBy:   'è¯·è¾“å…¥æ‚¨çš„å§“åã€‚',
        successTitle:    'æŠ¥å‘ŠæˆåŠŸï¼',
        successSub1:     'æ„Ÿè°¢æ‚¨ã€‚æ‚¨çš„é—®é¢˜æŠ¥å‘Šå·²è®°å½•ã€‚',
        successSub2:     'ç»´ä¿®å›¢é˜Ÿå°†å®¡æ ¸å¹¶å¤„ç†ã€‚',
        btnAgain:        'æŠ¥å‘Šå¦ä¸€ä¸ªé—®é¢˜',
        bannerPrefix:    'ä½ç½®ï¼š',
        submitting:      'æäº¤ä¸­â€¦',
        submitFailed:    'æäº¤å¤±è´¥ï¼š'
    }
};

const UNIT_ZH = {
    '#06-27/15/16/17 (Main CK Area)': '#06-27/15/16/17ï¼ˆä¸»ä¸­å¤®å¨æˆ¿åŒºï¼‰',
    '#06-24 (Raw Prep)':             '#06-24ï¼ˆç”Ÿé£Ÿå‡†å¤‡ï¼‰',
    '#06-19 (Bakery)':               '#06-19ï¼ˆé¢åŒ…æˆ¿ï¼‰',
    '#06-08 (Dishwashing)':          '#06-08ï¼ˆæ´—ç£—é—´ï¼‰',
    '#05-26':                        '#05-26',
    '#05-27 (Tay Sauce Kitchen)':    '#05-27ï¼ˆæ³°é…±å¨æˆ¿ï¼‰',
    '#04-08 (Confinement)':          '#04-08ï¼ˆåµæœˆä¸­å¿ƒï¼‰'
};

const SUB_AREA_ZH = {
    'Combi Oven Area':  'ä¸‡èƒ½çƒ¤ç‚‰åŒº',
    'Deep Frying Area': 'ç‚¸é”…åŒº',
    'Stir Frying Area': 'ç‚’é”…åŒº',
    'Packing Area':     'åŒ…è£…åŒº',
    'Salad Room':       'æ²™å¾‹æˆ¿',
    'Fruit Room':       'æ°´æœæˆ¿',
    'Cold Room':        'å†·è—å®¤',
    'Pan Fry Area':     'ç…é”…åŒº',
    'Braising Area':    'åœ†ç«åŒº',
    'Big Store':        'å¤§ä»“åº“',
    'Small Store':      'å°ä»“åº“',
    'Old Sauce Area':   'æ—§é…±æ–™åŒº',
    'Office/Changing Room Area': 'åŠå…¬å®¤/æŠ¥é•’å®¤',
    'Vegetable Prep Room': 'è”¬èœå‡†å¤‡å®¤'
};

let lang = 'en';

// â”€â”€ Unit change handler â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function onUnitChange() {
    const unit = document.getElementById('unit').value;
    const isMainCK = unit === MAIN_CK;
    document.getElementById('fieldSubArea').style.display = isMainCK ? 'block' : 'none';
    if (!isMainCK) document.getElementById('subArea').value = '';
    updateBanner();
}

function updateBanner() {
    const unit = document.getElementById('unit').value;
    if (!unit) { document.getElementById('areaBanner').classList.remove('visible'); return; }
    const t = T[lang];
    const unitDisplay = lang === 'zh' ? (UNIT_ZH[unit] || unit) : unit;
    const subArea     = document.getElementById('subArea').value;
    const subDisplay  = subArea ? (' â€º ' + (lang === 'zh' ? (SUB_AREA_ZH[subArea] || subArea) : subArea)) : '';
    document.getElementById('areaBannerText').textContent = t.bannerPrefix + ' ' + unitDisplay + subDisplay;
    document.getElementById('areaBanner').classList.add('visible');
}

function setLang(l) {
    lang = l;
    document.getElementById('btnEN').classList.toggle('active', l === 'en');
    document.getElementById('btnZH').classList.toggle('active', l === 'zh');

    const t = T[l];
    const textIds = ['hdrTitle','hdrSub','lblSecLocation','lblSpecific','lblOptional',
        'lblSecDetails','lblSecReporter',
        'optUnitDefault','optSubAreaDefault',
        'errUnit','errSubArea','errIssue','errReportedBy',
        'successTitle','successSub1','successSub2','btnAgain'
    ];
    textIds.forEach(id => {
        const el = document.getElementById(id);
        if (el && t[id] !== undefined) el.textContent = t[id];
    });

    document.getElementById('lblUnit').innerHTML       = t.lblUnit    + ' <span class="req">*</span>';
    document.getElementById('lblSubArea').innerHTML    = t.lblSubArea + ' <span class="req">*</span>';
    document.getElementById('lblIssue').innerHTML      = t.lblIssue   + ' <span class="req">*</span>';
    document.getElementById('lblReportedBy').innerHTML = t.lblReportedBy + ' <span class="req">*</span>';
    document.getElementById('lblPriority').textContent  = t.lblPriority;
    document.getElementById('lblPrioNormal').textContent = t.lblPrioNormal;
    document.getElementById('lblPrioUrgent').textContent = t.lblPrioUrgent;

    document.getElementById('issue').placeholder      = t.phIssue;
    document.getElementById('reportedBy').placeholder = t.phReportedBy;
    document.getElementById('submitBtn').textContent  = t.submitBtn;

    updateBanner();
}

// â”€â”€ Init: read ?unit= / ?area= params (QR backward-compat) â”€â”€
window.addEventListener('DOMContentLoaded', () => {
    const browserLang = (navigator.language || navigator.userLanguage || 'en').toLowerCase();
    if (browserLang.startsWith('zh')) setLang('zh'); else setLang('en');

    // Show sub-area immediately if a unit is pre-selected (e.g. default)
    onUnitChange();

    const params     = new URLSearchParams(window.location.search);
    const unitParam  = params.get('unit');
    const areaParam  = params.get('area');
    const unitSel    = document.getElementById('unit');
    const subAreaSel = document.getElementById('subArea');

    if (unitParam) {
        // Explicit ?unit= param (new QR codes)
        for (const opt of unitSel.options) {
            if (opt.value === unitParam) { opt.selected = true; break; }
        }
        onUnitChange();
        if (areaParam && unitParam === MAIN_CK) {
            for (const opt of subAreaSel.options) {
                if (opt.value === areaParam) { opt.selected = true; break; }
            }
        }
    } else if (areaParam) {
        // Legacy ?area= param from existing QR codes â€” auto-detect
        if (SUB_AREAS.includes(areaParam)) {
            // It's a Main CK sub-area
            for (const opt of unitSel.options) {
                if (opt.value === MAIN_CK) { opt.selected = true; break; }
            }
            onUnitChange();
            for (const opt of subAreaSel.options) {
                if (opt.value === areaParam) { opt.selected = true; break; }
            }
        } else {
            // It's a unit name
            let matched = false;
            for (const opt of unitSel.options) {
                if (opt.value === areaParam || opt.value.toLowerCase() === areaParam.toLowerCase()) {
                    opt.selected = true; matched = true; break;
                }
            }
            if (!matched) {
                const opt = new Option(areaParam, areaParam, true, true);
                unitSel.appendChild(opt);
            }
            onUnitChange();
        }
    }
    updateBanner();
});

// â”€â”€ Validation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function validate() {
    const t = T[lang];
    let ok = true;

    // Unit (always required)
    const unitEl   = document.getElementById('unit');
    const unitWrap = document.getElementById('fieldUnit');
    const unitErr  = document.getElementById('errUnit');
    if (!unitEl.value.trim()) {
        unitWrap.classList.add('has-error');
        if (unitErr && t.errUnit) unitErr.textContent = t.errUnit;
        ok = false;
    } else {
        unitWrap.classList.remove('has-error');
    }

    // Sub-area (required only when Main CK)
    if (unitEl.value === MAIN_CK) {
        const subEl   = document.getElementById('subArea');
        const subWrap = document.getElementById('fieldSubArea');
        const subErr  = document.getElementById('errSubArea');
        if (!subEl.value.trim()) {
            subWrap.classList.add('has-error');
            if (subErr && t.errSubArea) subErr.textContent = t.errSubArea;
            ok = false;
        } else {
            subWrap.classList.remove('has-error');
        }
    }

    // Issue
    const issueEl   = document.getElementById('issue');
    const issueWrap = document.getElementById('fieldIssue');
    const issueErr  = document.getElementById('errIssue');
    if (!issueEl.value.trim()) {
        issueWrap.classList.add('has-error');
        if (issueErr && t.errIssue) issueErr.textContent = t.errIssue;
        ok = false;
    } else {
        issueWrap.classList.remove('has-error');
    }

    // Reporter
    const repEl   = document.getElementById('reportedBy');
    const repWrap = document.getElementById('fieldReportedBy');
    const repErr  = document.getElementById('errReportedBy');
    if (!repEl.value.trim()) {
        repWrap.classList.add('has-error');
        if (repErr && t.errReportedBy) repErr.textContent = t.errReportedBy;
        ok = false;
    } else {
        repWrap.classList.remove('has-error');
    }

    return ok;
}

// Build the area value to submit (sub-area for Main CK, unit otherwise)
function getAreaValue() {
    const unit = document.getElementById('unit').value.trim();
    if (unit === MAIN_CK) {
        const sub = document.getElementById('subArea').value.trim();
        return sub || unit;
    }
    return unit;
}

// â”€â”€ Submit â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('issueForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    if (!validate()) return;

    const btn = document.getElementById('submitBtn');
    btn.disabled = true;
    btn.textContent = T[lang].submitting;

    const issueText = document.getElementById('issue').value.trim();
    const titleText = issueText.split(/[.\n]/)[0].trim().slice(0, 80) || issueText.slice(0, 80);

    const selectedPriority = document.querySelector('input[name="priority"]:checked')?.value || 'Normal';
    const priorityValue = selectedPriority === 'Urgent' ? 'High' : 'Medium';

    const fd = new FormData();
    fd.append('area',             getAreaValue());
    fd.append('category',         'Other');
    fd.append('title',            titleText);
    fd.append('description',      issueText);
    fd.append('priority',         priorityValue);
    fd.append('specificLocation', document.getElementById('specificLocation').value.trim());
    fd.append('reportedBy',       document.getElementById('reportedBy').value.trim());
    const photoFile = document.getElementById('issuePhoto').files[0];
    if (photoFile) fd.append('image', photoFile);

    try {
        const controller = new AbortController();
        const timeout = setTimeout(() => controller.abort(), 30000);
        const res = await fetch(`${API_BASE}/issues`, {
            method: 'POST',
            body: fd,
            signal: controller.signal
        });
        clearTimeout(timeout);
        if (!res.ok) { const e = await res.json(); throw new Error(e.message || 'Server error'); }
        const newIssue = await res.json();

        document.getElementById('formCard').style.display      = 'none';
        document.getElementById('successScreen').style.display = 'block';
        document.getElementById('issueRef').textContent        = `Reference: ${newIssue.issueId || 'Logged'}`;

        setLang(lang);

    } catch (err) {
        btn.disabled = false;
        btn.textContent = T[lang].submitBtn;
        const msg = err.name === 'AbortError' ? 'Request timed out. Please try again.' : err.message;
        alert(T[lang].submitFailed + msg);
    }
});

// â”€â”€ Photo preview â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function handlePhotoSelect(input) {
    const file = input.files[0];
    const preview    = document.getElementById('photoPreview');
    const previewImg = document.getElementById('photoPreviewImg');
    const nameEl     = document.getElementById('photoFileName');
    const labelEl    = document.getElementById('photoLabelText');
    if (file) {
        previewImg.src = URL.createObjectURL(file);
        nameEl.textContent = file.name;
        preview.style.display = 'block';
        labelEl.textContent = 'âœ… Photo selected â€” tap to change';
    } else {
        preview.style.display = 'none';
        labelEl.textContent = 'Tap to attach a photo';
    }
}

// â”€â”€ Reset â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function resetForm() {
    document.getElementById('issueForm').reset();
    document.getElementById('prioNormal').checked          = true;
    document.getElementById('photoPreview').style.display  = 'none';
    document.getElementById('photoLabelText').textContent  = 'Tap to attach a photo';
    document.getElementById('formCard').style.display      = 'block';
    document.getElementById('successScreen').style.display = 'none';
    document.getElementById('submitBtn').disabled          = false;
    document.getElementById('submitBtn').textContent       = T[lang].submitBtn;
    document.querySelectorAll('.has-error').forEach(el => el.classList.remove('has-error'));
    document.getElementById('fieldSubArea').style.display  = 'none';
    document.getElementById('areaBanner').classList.remove('visible');
}
</script>
</body>
</html>